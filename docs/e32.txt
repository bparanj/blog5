
-

List of tasks with due date and Edit task link in `tasks/index.html.erb`.

```
<tbody>
  <% @task_months.each do |month, tasks| %>
    <%= month.strftime('%B') %>
  <tr>
    <% for task in tasks %>
  	<div class='task'>
  		<strong> task.name </strong>
  		<%= task.due_date.to_s(:due_time) %>
  	</div>
  	<%= link_to 'Edit', edit_task_path(task) %>
    <% end %>
   </tr>		 
  <% end %>	  
</tbody>
```

-


Click Edit link to edit task. Name of task name, due date has datetime drop down boxes is displayed in `tasks/_form.html.erb`:

```
<%= form_for(task) do |f| %>
  <div class="field">
    <%= f.label :name %>
    <%= f.text_field :name %>
  </div>

  <div class="field">
    <%= f.label :due_date %>
    <%= f.datetime_select :due_date %>
  </div>

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
```

-

In the form partial, change the `datetime_select` to text field.

```rhtml
<%= f.text_field :due_date_string %>
```

-

Add `due_date_string` method to Task model.

```ruby
class Task < ApplicationRecord
  belongs_to :project
  has_many :comments

  def due_date_string
    due_date.to_s(:db)
  end
  
  def due_date_string=(due_date_s)
    self.due_date = Time.parse(due_date_s)
  end
end
  
 -
 
 In tasks controller:
 
 ```ruby
 def task_params
   params.require(:task).permit(:name, :complete, :due_date_string)
 end
 ```
 
 -
 
 Reload page `http://localhost:3000/tasks/3/edit`. Change the date and update. It works.
 
 -
 
 Illegal input throws exception: 
 
 ```
 argument out of range
 ```
 
 - 

```
<%= form_for(task) do |f| %>
  <div class="field">
   <%= f.label :name %>
   <%= f.text_field :name %>
  </div>
  
  <div class="field">
   <%= f.label :due_date %>
   <%= f.text_field :due_date %>
  </div>
  
  <div class="actions">
   <%= f.submit %>
  </div>
<% end %>
```
 
 -
 
 ```ruby
 def task_params
   params.require(:task).permit(:name, :complete, :due_date)
 end
 ```
 
 Remove setter and getter in the task model:
 
 def due_date_string
   due_date.to_s(:db)
 end
 
 def due_date_string=(due_date_s)
   self.due_date = Time.parse(due_date_s)
 end
 
 -
 
 
class DatetimeValidator < ActiveModel::Validator
  def validate(record)
    Time.parse(record.due_date.to_s)
  rescue ArgumentError
    record.errors[:due_date] << "Invalid datetime format"
  end
end
 
 -
 
class Task < ApplicationRecord
  belongs_to :project
  has_many :comments

  validates_with DatetimeValidator  
end
 
-

   
Edit date with junk as the due_date. You will now see validation error. The user entered old value is also retained.

-

http://railscasts.com/episodes/32-time-in-text-field?view=comments

[Date and time validation plugin for ActiveModel and Rails.](https://github.com/adzap/validates_timeliness/ 'Date and time validation plugin for ActiveModel and Rails.')
[Chronic gem](https://github.com/mojombo/chronic 'Chronic gem') for fancy time parsing.

 